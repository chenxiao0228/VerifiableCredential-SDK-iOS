//
//  serializationTests.swift
//  serializationTests
//
//  Created by Sydney Morton on 7/27/20.
//  Copyright Â© 2020 Microsoft. All rights reserved.
//

import XCTest
@testable import serialization

class serializationTests: XCTestCase {
    
    let serializer = Serializer()

    override func setUpWithError() throws {}

    func testAndreasContract() throws {
        let data = serializedContract.data(using: .utf8)!
        let contract = try serializer.deserialize(Contract.self, data: data)
        print(contract)
    }
    
    func testBase64UrlDecoding() throws {
        let siop = base64UrlEndcodedString.fromBase64URL()!
        let data = siop.data(using: .utf8)!
        print(try serializer.deserialize(OpenIdConnectSelfIssuedContents.self, data: data))
        
    }
    
    let base64UrlEndcodedString = "eyJyZXNwb25zZV90eXBlIjoiaWR0b2tlbiIsInJlc3BvbnNlX21vZGUiOiJmb3JtX3Bvc3QiLCJjbGllbnRfaWQiOiJodHRwczovL3Rlc3QtcmVseWluZ3BhcnR5LmF6dXJld2Vic2l0ZXMubmV0L3JlcXVlc3QiLCJyZWRpcmVjdF91cmkiOiJodHRwczovL3Rlc3QtcmVseWluZ3BhcnR5LmF6dXJld2Vic2l0ZXMubmV0L3ZlcmlmeSIsInNjb3BlIjoib3BlbmlkIGRpZF9hdXRobiIsInN0YXRlIjoibHZhbUwtbXZpMUwxS3ciLCJub25jZSI6Ik9hVi1GUVgwVTI2WnpRIiwiYXR0ZXN0YXRpb25zIjp7InByZXNlbnRhdGlvbnMiOlt7InJlcXVpcmVkIjp0cnVlLCJjcmVkZW50aWFsVHlwZSI6IlZlcmlmaWVkQUlFbmdpbmVlckNlcnRpZmljYXRlIiwidmFsaWRpdHlJbnRlcnZhbCI6MTAwMCwiY29udHJhY3RzIjpbImh0dHBzOi8vcG9ydGFibGVpZGVudGl0eWNhcmRzLmF6dXJlLWFwaS5uZXQvdjEuMC85YzU5YmU4Yi1iZDE4LTQ1ZDktYjlkOS0wODJiYzA3YzA5NGYvcG9ydGFibGVJZGVudGl0aWVzL2NvbnRyYWN0cy9BSUVuZ2luZWVyQ2VydCJdLCJpc3N1ZXJzIjpbeyJpc3MiOiJkaWQ6aW9uOkVpQVE4REtDSTNXbVFuYWI4NGxvaHo2LUpPRFFPd1Y5LWVzV2VzcnVCTHE1NFE_LWlvbi1pbml0aWFsLXN0YXRlPWV5SmtaV3gwWVY5b1lYTm9Jam9pUldsQ04wUjFkRWRaTkc1TlRXSnRZMlJYY0RaTFZEaGpZMlpvVlZCRFNWbFdWRkV3VW1reVVXdERYek5YVVNJc0luSmxZMjkyWlhKNVgyTnZiVzFwZEcxbGJuUWlPaUpGYVVSclQwdFVRMmR1VVdJeFdtZzNaVFpzV0dWWE9HSkdkbUZxTFRCMlkwd3hjWFJyZWw5WmRqTXdaVXhuSW4wLmV5SjFjR1JoZEdWZlkyOXRiV2wwYldWdWRDSTZJa1ZwUkhsRFlYRkdNRnBFTmxsRmJtRkNhVUpqWmtneVQzaDBkSGh5ZDFaeGFGWjRXamcwUTFsTk5VVnBRMEVpTENKd1lYUmphR1Z6SWpwYmV5SmhZM1JwYjI0aU9pSnlaWEJzWVdObElpd2laRzlqZFcxbGJuUWlPbnNpY0hWaWJHbGpYMnRsZVhNaU9sdDdJbWxrSWpvaWMybG5YMkl4TkRJelpHVTVJaXdpZEhsd1pTSTZJa1ZqWkhOaFUyVmpjREkxTm1zeFZtVnlhV1pwWTJGMGFXOXVTMlY1TWpBeE9TSXNJbXAzYXlJNmV5SnJkSGtpT2lKRlF5SXNJbU55ZGlJNkluTmxZM0F5TlRack1TSXNJbmdpT2lKUFdsVnVlR010Um5CU2NTMUpaamQzWVdONlZVb3hlamRJZEVwU1RFRjZVRFZpUjFsR1UyNTBUbFZKSWl3aWVTSTZJa2wxUTJjMlpISjFibTg0V2preFgyTXdZVmh2ZG5SZldWVjBUSEJOUWw5T015MTFhelpoY1ZVM1ltc2lmU3dpY0hWeWNHOXpaU0k2V3lKaGRYUm9JaXdpWjJWdVpYSmhiQ0pkZlYxOWZWMTkifV19XX0sImlzcyI6ImRpZDppb246RWlCcGxGZENaYnpnV2lTdkMtU2w4UXJVTHIyRWs1Zkx3cFhSajB0R3lFYUUyZz8taW9uLWluaXRpYWwtc3RhdGU9ZXlKa1pXeDBZVjlvWVhOb0lqb2lSV2xFUnkxalRWOUNielJ6YzBOVVNsZFFia1pMV0Mxb1VXODRUWGMwYjJOb2JVOW1UREZsUTNGMVVFd3haeUlzSW5KbFkyOTJaWEo1WDJOdmJXMXBkRzFsYm5RaU9pSkZhVUk0TVZsU2RIUlZSMjVyYzI1ek4wWTRSVkpHYUVkU05raEtVbkZ4U3pSNU1uRTVlRlpLWkV0VlowaFJJbjAuZXlKMWNHUmhkR1ZmWTI5dGJXbDBiV1Z1ZENJNklrVnBRVGxoTjJ0MWVXdHhMWE5tWVRoSGFITmxkemhoY1RWaFkwMUNWV3BxYldST1pYbzVhMWh4UWt4RVNrRWlMQ0p3WVhSamFHVnpJanBiZXlKaFkzUnBiMjRpT2lKeVpYQnNZV05sSWl3aVpHOWpkVzFsYm5RaU9uc2ljSFZpYkdsalgydGxlWE1pT2x0N0ltbGtJam9pYzJsbmJpSXNJblI1Y0dVaU9pSkZZMlJ6WVZObFkzQXlOVFpyTVZabGNtbG1hV05oZEdsdmJrdGxlVEl3TVRraUxDSnFkMnNpT25zaWEzUjVJam9pUlVNaUxDSmpjbllpT2lKelpXTndNalUyYXpFaUxDSjRJam9pWkhWVk1HTnZWbGxYWm1ObFJIQmZSRVJHTUdwWExUTlNjbHB1T1ZCdlFuWnZaazF0VFhNMWFHWXlaeUlzSW5raU9pSlZXR0pIZFdjemNqbDBaV2RPZEZJdGVYUktNbXRoY1hsc1puTlZNWGg0ZVVnd1YyNVpSM1l5VlZjNEluMHNJbkIxY25CdmMyVWlPbHNpWVhWMGFDSXNJbWRsYm1WeVlXd2lYWDFkZlgxZGZRIiwicmVnaXN0cmF0aW9uIjp7ImNsaWVudF9uYW1lIjoiRGVjZW50cmFsaXplZCBJZGVudGl0eSBUZWFtIiwiY2xpZW50X3B1cnBvc2UiOiJHaXZlIHVzIHRoaXMgaW5mb3JtYXRpb24gcGxlYXNlICh3aXRoIGNoZXJyeSBvbiB0b3ApISIsInRvc191cmkiOiJodHRwczovL3Rlc3QtcmVseWluZ3BhcnR5LmF6dXJld2Vic2l0ZXMubmV0L3Rvcy5odG1sIiwibG9nb191cmkiOiJodHRwczovL3Rlc3QtcmVseWluZ3BhcnR5LmF6dXJld2Vic2l0ZXMubmV0L2ltYWdlcy9kaWRfbG9nby5wbmcifSwiaWF0IjoxNTk2MDUzNjMwLCJleHAiOjE1OTYwNTM5MzAsInByb21wdCI6ImNyZWF0ZSJ9"
    
    let serializedContract =  """
                                {"id":"AndreasUltraCard","display":{"id":"display","locale":"en-US","contract":"https://portableidentitycards.azure-api.net/dev-v1.0/536279f6-15cc-45f2-be2d-61e352b51eef/portableIdentities/contracts/AndreasUltraCard","card":{"title":"A Card for Andreas","issuedBy":"Sydney","backgroundColor":"#212121","textColor":"#FFFFFF","logo":{"uri":"https://test-relyingparty.azurewebsites.net/images/andreas_logo.png","description":"did logo"},"description":"A Card for Andreas."},"consent":{"title":"Do you want to get your Woodgrove Identity Card?","instructions":"You will need to sign in with your Woodgrove credentials."},"claims":{"vc.credentialSubject.jobTitle":{"type":"String","label":"Job Title"},"vc.credentialSubject.name":{"type":"String","label":"Name"},"vc.credentialSubject.andreasIsCool":{"type":"String","label":"Is Andreas Cool"},"vc.credentialSubject.businessName":{"type":"String","label":"Business Name"},"vc.credentialSubject.favoriteColor":{"type":"String","label":"Favorite Color"}}},"input":{"id":"input","credentialIssuer":"https://portableidentitycards.azure-api.net/dev-v1.0/536279f6-15cc-45f2-be2d-61e352b51eef/portableIdentities/card/issue","issuer":"did:ion:EiCfeOciEjwupwRQsJC3wMZzz3_M3XIo6bhy7aJkCG6CAQ?-ion-initial-state=eyJkZWx0YV9oYXNoIjoiRWlEMDQwY2lQakUxR0xqLXEyWmRyLVJaXzVlcU8yNFlDMFI5bTlEd2ZHMkdGQSIsInJlY292ZXJ5X2NvbW1pdG1lbnQiOiJFaUMyRmQ5UE90emFNcUtMaDNRTFp0Wk43V0RDRHJjdkN4eTNvdlNERDhKRGVRIn0.eyJ1cGRhdGVfY29tbWl0bWVudCI6IkVpQ2gtaTFDMW1fM2N4SGJNM3pXemRRdExxMnBvRldaX25FVEJTb0NhT2JZTWciLCJwYXRjaGVzIjpbeyJhY3Rpb24iOiJyZXBsYWNlIiwiZG9jdW1lbnQiOnsicHVibGljX2tleXMiOlt7ImlkIjoic2lnXzBmOTdlZWZjIiwidHlwZSI6IkVjZHNhU2VjcDI1NmsxVmVyaWZpY2F0aW9uS2V5MjAxOSIsImp3ayI6eyJrdHkiOiJFQyIsImNydiI6InNlY3AyNTZrMSIsIngiOiJoQ0xsb3JJbGx2M2FWSkRiYkNxM0VHbzU2bWV6Q3RLWkZGcUtvS3RVc3BzIiwieSI6Imh1VG5iTEc3MWU0NDNEeVJkeU5DX3dfc3paR0hVYUcxUHdsMHpXb0h2LUEifSwicHVycG9zZSI6WyJhdXRoIiwiZ2VuZXJhbCJdfV19fV19","attestations":{"selfIssued":{"encrypted":false,"claims":[{"claim":"favoriteSport","type":"String","required":false,"indexed":false},{"claim":"favoriteColor","type":"String","required":false,"indexed":false}],"required":false},"presentations":[{"encrypted":false,"claims":[{"claim":"vc.credentialSubject.name","required":true,"indexed":false}],"required":true,"credentialType":"WoodgroveIdentityCredential","issuers":[{"iss":"did:ion:EiDClccVJaiy6gDk6YW7PgZ9SjAUyVLc34_ITVMeFLEvdA?-ion-initial-state=eyJkZWx0YV9oYXNoIjoiRWlDTmMydnoxUWI0bzJSMFBoVGpDSDA0cGhZOVdwUEpCMEhJX0hDT0NyTHlvdyIsInJlY292ZXJ5X2tleSI6eyJrdHkiOiJFQyIsImNydiI6InNlY3AyNTZrMSIsIngiOiJFRXFVZmRzOUhtdUJBZ2V1bUtLbE1BZ2dhTjRvYXZtT3ZWLUhJZ1RLM1Y0IiwieSI6ImdIVlFablBZYkdBWkJicW9vRDJTS0VWNXBSaml5UGxFWjZ5VEZtMGpHNmcifSwicmVjb3ZlcnlfY29tbWl0bWVudCI6IkVpQnYzdWFXTXBIQXhNRlJ2WVd5LVlwSDRISE5MQW1KSWpyUzllRTFZcnNiMlEifQ.eyJ1cGRhdGVfY29tbWl0bWVudCI6IkVpQ2VJQ0dCT09EbDVqSXRUSHJzLWNDd2RfcnQtckhobElnQkQweXJ0aEFBWWciLCJwYXRjaGVzIjpbeyJhY3Rpb24iOiJyZXBsYWNlIiwiZG9jdW1lbnQiOnsicHVibGljS2V5cyI6W3siaWQiOiJzaWdfOTdhN2VlOTUiLCJ0eXBlIjoiRWNkc2FTZWNwMjU2azFWZXJpZmljYXRpb25LZXkyMDE5IiwiandrIjp7Imt0eSI6IkVDIiwiY3J2Ijoic2VjcDI1NmsxIiwieCI6Ik9XNzBWOEpNOHpoQVZSZTloRUp5Z1ZwTlJPalZHbjJpcW5qbUl0REVhM3ciLCJ5IjoiOTJUV3gzbVBJZHpwQ2xMTHRzdUNwTUROZ1FwMlc5SERiNGY3dlFzMGhvbyJ9LCJ1c2FnZSI6WyJvcHMiLCJhdXRoIiwiZ2VuZXJhbCJdfV19fV19"}],"contracts":["https://portableidentitycards.azure-api.net/dev-v1.0/536279f6-15cc-45f2-be2d-61e352b51eef/portableIdentities/contracts/WoodgroveId"]},{"encrypted":false,"claims":[{"claim":"vc.credentialSubject.businessName","required":true,"indexed":false}],"required":true,"credentialType":"BusinessCardCredential","issuers":[{"iss":"did:ion:EiDClccVJaiy6gDk6YW7PgZ9SjAUyVLc34_ITVMeFLEvdA?-ion-initial-state=eyJkZWx0YV9oYXNoIjoiRWlDTmMydnoxUWI0bzJSMFBoVGpDSDA0cGhZOVdwUEpCMEhJX0hDT0NyTHlvdyIsInJlY292ZXJ5X2tleSI6eyJrdHkiOiJFQyIsImNydiI6InNlY3AyNTZrMSIsIngiOiJFRXFVZmRzOUhtdUJBZ2V1bUtLbE1BZ2dhTjRvYXZtT3ZWLUhJZ1RLM1Y0IiwieSI6ImdIVlFablBZYkdBWkJicW9vRDJTS0VWNXBSaml5UGxFWjZ5VEZtMGpHNmcifSwicmVjb3ZlcnlfY29tbWl0bWVudCI6IkVpQnYzdWFXTXBIQXhNRlJ2WVd5LVlwSDRISE5MQW1KSWpyUzllRTFZcnNiMlEifQ.eyJ1cGRhdGVfY29tbWl0bWVudCI6IkVpQ2VJQ0dCT09EbDVqSXRUSHJzLWNDd2RfcnQtckhobElnQkQweXJ0aEFBWWciLCJwYXRjaGVzIjpbeyJhY3Rpb24iOiJyZXBsYWNlIiwiZG9jdW1lbnQiOnsicHVibGljS2V5cyI6W3siaWQiOiJzaWdfOTdhN2VlOTUiLCJ0eXBlIjoiRWNkc2FTZWNwMjU2azFWZXJpZmljYXRpb25LZXkyMDE5IiwiandrIjp7Imt0eSI6IkVDIiwiY3J2Ijoic2VjcDI1NmsxIiwieCI6Ik9XNzBWOEpNOHpoQVZSZTloRUp5Z1ZwTlJPalZHbjJpcW5qbUl0REVhM3ciLCJ5IjoiOTJUV3gzbVBJZHpwQ2xMTHRzdUNwTUROZ1FwMlc5SERiNGY3dlFzMGhvbyJ9LCJ1c2FnZSI6WyJvcHMiLCJhdXRoIiwiZ2VuZXJhbCJdfV19fV19"}],"contracts":["https://portableidentitycards.azure-api.net/dev-v1.0/536279f6-15cc-45f2-be2d-61e352b51eef/portableIdentities/contracts/BusinessCard"]}],"idTokens":[{"encrypted":false,"claims":[{"claim":"upn","required":false,"indexed":false},{"claim":"given_name","required":false,"indexed":false},{"claim":"family_name","required":false,"indexed":false}],"required":false,"configuration":"https://login.microsoftonline.com/woodgrove.ms/.well-known/openid-configuration","client_id":"40be4fb5-7f3a-470b-aa37-66ed43821bd7","redirect_uri":"https://didwebtest.azurewebsites.net/verify"}]}}}
                    """

}
